version: "3.8"
name: datajoint-link
services:
  dev:
    build:
      context: .
      args:
        BASE: cblessing24/python3.8:latest
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - datajoint-link:/src
    command: "tmux"
  pytest:
    image: cblessing24/datajoint-link:latest
    volumes:
      - datajoint-link:/src
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      DOCKER_NETWORK: datajoint-link_test
    networks:
      - test
    command: ["pytest"]
  profile:
    build: .
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - .:/src/datajoint-link
      - pypackages:/src/datajoint-link/__pypackages__
    networks:
      - profiling_network
    entrypoint: ["./entrypoints/profile_entrypoint.sh"]

networks:
  profiling_network:
    name: profiling_network
  test:

volumes:
  pypackages:
  datajoint-link:
